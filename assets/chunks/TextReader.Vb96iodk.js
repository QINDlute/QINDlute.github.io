import{d as k,p as x,v as V,P as L,$ as A,c as B,o as M,j as m,r as O,_ as P}from"./framework.BzC-9uGu.js";const G={class:"text-reader"},I="Microsoft Libby Online (Natural) - English (United Kingdom)",E="en-GB",R=5,U=k({__name:"TextReader",setup(D){let n=null,d=null,l=null,p=!1;const g=`text-reader-${Math.random().toString(36).substr(2,9)}`,a=x(!1),i=x(!1),_=x(null),N=()=>{var s,f,h;if(!_.value)return;const t=_.value;let e=!1;for(let u=0;u<t.childNodes.length;u++){const o=t.childNodes[u];if(o.nodeType===Node.TEXT_NODE){const r=((s=o.textContent)==null?void 0:s.trim())||"";if(r){const c=document.createElement("p");c.textContent=r,t.insertBefore(c,o),t.removeChild(o),u--,e=!0}else t.removeChild(o),u--}else if(o.nodeType===Node.ELEMENT_NODE){if(o.nodeName==="P"){e=!0;continue}if(!e){const r=o;if(r.childNodes.length===1&&((f=r.firstChild)==null?void 0:f.nodeType)===Node.TEXT_NODE){const c=((h=r.firstChild.textContent)==null?void 0:h.trim())||"";if(c){const v=document.createElement("p");v.textContent=c,t.insertBefore(v,o),t.removeChild(o),u--,e=!0}}}}}};let T=null,C=0;const w=()=>{if(!n)return;C++;const t=n.getVoices();if(t.length===0){p=!1;return}let e=null;e=t.find(s=>s.lang===E),e||(e=t.find(s=>s.name===I)),e||(e=t.find(s=>{const f=s.name.toLowerCase();return(f.includes("libby")||f.includes("online"))&&s.lang.startsWith("en-")})),e||(e=t.find(s=>s.name.toLowerCase().includes("microsoft")&&s.lang.startsWith("en-"))),e||(e=t.find(s=>s.lang.startsWith("en-"))),!e&&t.length>0&&(e=t[0]),e&&(d=e),T&&(clearTimeout(T),T=null),p=!1},y=()=>{n&&(n.cancel(),l=null)},S=()=>{if(!("speechSynthesis"in window)||p)return;p=!0,n=window.speechSynthesis,C=0,n.onvoiceschanged=()=>{w()};const t=n.getVoices();w(),setTimeout(()=>{const e=n.getVoices();e.length>0&&e.length>t.length&&w()},1e3),T=window.setTimeout(()=>{p=!1},5e3),window.addEventListener("beforeunload",y)};V(()=>{L(()=>{n||S(),N()})}),A(()=>{l===g&&n&&(n.cancel(),l=null,a.value=!1,i.value=!1)});const b=()=>{var u;if(!n&&(S(),!n)){alert("Your browser does not support speech synthesis.");return}const t=(u=_.value.textContent)==null?void 0:u.trim();if(!t){alert("No text to read.");return}C<R&&w();const e=l===g,s=n.speaking,f=n.paused;if(e){if(i.value||f){n.cancel(),i.value=!1,a.value=!1;const o=n,r=t;setTimeout(()=>{l=g,a.value=!0;const c=new SpeechSynthesisUtterance(r);c.lang=E,d&&(c.voice=d),c.onend=()=>{l=null,a.value=!1,i.value=!1},c.onerror=v=>{v.error,l=null,a.value=!1,i.value=!1};try{o.speak(c)}catch{l=null,a.value=!1,i.value=!1}},100);return}else if(s){n.pause(),a.value=!1,i.value=!0;return}}else{n.cancel(),i.value=!1,setTimeout(()=>{h()},50);return}h();function h(){l=g,a.value=!0;const o=new SpeechSynthesisUtterance(t);o.lang=E,d&&(o.voice=d),o.onend=()=>{l=null,a.value=!1,i.value=!1},o.onerror=r=>{r.error,l=null,a.value=!1,i.value=!1};try{n.speak(o)}catch{l=null,a.value=!1,i.value=!1,alert("Failed to start speech. Please try again.")}}};return(t,e)=>(M(),B("div",G,[m("button",{class:"text-reader-button",onClick:b,"aria-label":"Read text aloud"},[...e[0]||(e[0]=[m("svg",{class:"text-reader-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[m("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),m("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"})],-1)])]),m("div",{ref_key:"contentRef",ref:_,class:"text-reader-content"},[O(t.$slots,"default",{},void 0,!0)],512)]))}}),X=P(U,[["__scopeId","data-v-f1c09327"]]);export{X as _};
